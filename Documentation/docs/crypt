stefan@olc.runtunfun.de's password:
Linux olc 6.1.0-31-amd64 #1 SMP PREEMPT_DYNAMIC Debian 6.1.128-1 (2025-02-07) x86_64

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
stefan@olc:~$ sudo cryptsetup luksDump /dev/vda5 | grep "^Key Slot"
[sudo] password for stefan:
stefan@olc:~$ sudo cryptsetup luksOpen --test-passphrase --verbose /dev/vda5
No usable token is available.
Enter passphrase for /dev/vda5:
Key slot 0 unlocked.
Command successful.
stefan@olc:~$ sudo -i
stefan@olc:~$ sudo mkdir -m0700 /etc/keys
stefan@olc:~$ sudo ( umask 0077 && dd if=/dev/urandom bs=1 count=64 of=/etc/keys/root.key conv=excl,fsync )
64+0 records in
64+0 records out
64 bytes copied, 0.0013641 s, 46.9 kB/s
stefan@olc:~$ sudo cryptsetup luksAddKey /dev/vda5 /etc/keys/root.key
Enter any existing passphrase:
stefan@olc:~$ sudo vi /etc/crypttab
stefan@olc:~$ sudo cat /etc/crypttab
vda5_crypt UUID=bbacc2c2-9796-48ff-b5c2-5bd7384ca2f4 /etc/keys/root.key luks,discard
root@olc:~# update-initramfs -u
update-initramfs: Generating /boot/initrd.img-6.1.0-31-amd64
cryptsetup: WARNING: Skipping root target vda5_crypt: uses a key file
stefan@olc:~$ sudo vi /etc/cryptsetup-initramfs/conf-hook
# KEYFILE_PATTERN: ...
# /etc/keys/{root,swap}.key, you can set KEYFILE_PATTERN="/etc/keys/*.key"
# If KEYFILE_PATTERN if null or unset (default) then no key file is
#KEYFILE_PATTERN=
KEYFILE_PATTERN="/etc/keys/*.key"
# unlocked interactively (i.e., not via keyfile nor keyscript) at
stefan@olc:~$ sudo update-initramfs -u -k all
update-initramfs: Generating /boot/initrd.img-6.1.0-31-amd64
cryptsetup: WARNING: Permissive UMASK (0022). Private key material within the
    initrd might be left unprotected.
update-initramfs: Generating /boot/initrd.img-6.1.0-9-amd64
cryptsetup: WARNING: Permissive UMASK (0022). Private key material within the
    initrd might be left unprotected.
stefan@olc:~$ sudo lsinitramfs /initrd.img | grep "^cryptroot/keyfiles/"
[sudo] password for stefan:
cryptroot/keyfiles/vda5_crypt.key



Quellen:
https://cryptsetup-team.pages.debian.net/cryptsetup/encrypted-boot.html
https://forums.debian.net/viewtopic.php?t=130809
https://unix.stackexchange.com/questions/164403/unlock-luks-encrypted-debian-root-with-key-file-on-boot-partition
